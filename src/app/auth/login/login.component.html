<div class="login-container">
  <!-- Video Background -->
  <video autoplay muted loop playsinline class="nebula-bg">
    <source src="/nebula.mp4" type="video/mp4">
    Your browser does not support video.
  </video>

  <!-- Login / Signup Form -->
  <form class="login-form" (ngSubmit)="submit()" #loginForm="ngForm">
    <h2>{{ isSignup ? 'Create Account' : 'Welcome Back' }}</h2>

    <!-- Username -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Username</mat-label>
      <input
        matInput
        type="text"
        [(ngModel)]="username"
        name="username"
        required
        minlength="3"
        [disabled]="loading"
      />
      <mat-error *ngIf="loginForm.controls['username']?.errors?.['required']">
        Username is required
      </mat-error>
      <mat-error *ngIf="loginForm.controls['username']?.errors?.['minlength']">
        Minimum 3 characters
      </mat-error>
    </mat-form-field>

    <!-- Email (Signup only) -->
    <mat-form-field appearance="fill" class="full-width" *ngIf="isSignup">
      <mat-label>Email</mat-label>
      <input
        matInput
        type="email"
        [(ngModel)]="email"
        name="email"
        required
        email
        [disabled]="loading"
      />
      <mat-error *ngIf="loginForm.controls['email']?.errors?.['required']">
        Email is required
      </mat-error>
      <mat-error *ngIf="loginForm.controls['email']?.errors?.['email']">
        Invalid email format
      </mat-error>
    </mat-form-field>

    <!-- Phone (Signup only) -->
    <mat-form-field appearance="fill" class="full-width" *ngIf="isSignup">
      <mat-label>Phone Number</mat-label>
      <input
        matInput
        type="tel"
        [(ngModel)]="phoneNumber"
        name="phoneNumber"
        required
        pattern="[0-9]{10}"
        [disabled]="loading"
      />
      <mat-hint>10-digit mobile number</mat-hint>
      <mat-error *ngIf="loginForm.controls['phoneNumber']?.errors?.['required']">
        Phone is required
      </mat-error>
      <mat-error *ngIf="loginForm.controls['phoneNumber']?.errors?.['pattern']">
        Enter 10 digits only
      </mat-error>
    </mat-form-field>

    <!-- Password -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Password</mat-label>
      <input
        matInput
        type="password"
        [(ngModel)]="password"
        name="password"
        required
        minlength="6"
        [disabled]="loading"
      />
      <mat-error *ngIf="loginForm.controls['password']?.errors?.['required']">
        Password is required
      </mat-error>
      <mat-error *ngIf="loginForm.controls['password']?.errors?.['minlength']">
        Minimum 6 characters
      </mat-error>
    </mat-form-field>

    <!-- Confirm Password (Signup only) -->
    <mat-form-field appearance="fill" class="full-width" *ngIf="isSignup">
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        type="password"
        [(ngModel)]="confirmPassword"
        name="confirmPassword"
        required
        [disabled]="loading"
      />
      <mat-error *ngIf="confirmPassword && password !== confirmPassword">
        Passwords do not match
      </mat-error>
    </mat-form-field>

    <!-- Submit Button -->
    <button
      mat-raised-button
      color="accent"
      type="submit"
      class="submit-btn"
      [disabled]="loading || loginForm.invalid || (isSignup && password !== confirmPassword)"
    >
      <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
      <span *ngIf="!loading">
        {{ isSignup ? 'Create Account' : 'Login' }}
      </span>
    </button>

    <!-- Error Message -->
    <div class="error-msg" *ngIf="error">
      <mat-icon>error</mat-icon>
      {{ error }}
    </div>

    <!-- Toggle Mode -->
    <p class="toggle-text">
      <a (click)="toggleMode()" class="toggle-link">
        {{ isSignup ? 'Already have an account? Login' : 'New user? Sign Up' }}
      </a>
    </p>

    <!-- Skip Button -->
    <button
      mat-stroked-button
      type="button"
      class="skip-btn"
      (click)="skip()"
      [disabled]="loading"
    >
      Skip for Now
    </button>
  </form>
</div>