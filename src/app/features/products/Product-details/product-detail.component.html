<div class="product-detail-page" *ngIf="product as p; else loading">

  <!-- BACK BUTTON -->
  <button mat-icon-button class="back-btn" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <div class="detail-grid">

    <!-- IMAGE SECTION -->
    <div class="image-section">
      <img [src]="p.image" class="detail-image" [alt]="p.name">

      <div class="image-thumbs" *ngIf="p.images?.length">
        <img *ngFor="let img of p.images" [src]="img" class="thumb">
      </div>
    </div>

    <!-- DETAILS SECTION -->
    <div class="details-section">

      <h1 class="product-title">{{ p.name }}</h1>

      <div class="rating" *ngIf="p.rating">
        <mat-icon *ngFor="let s of getStars(p.rating)">
          {{ s }}
        </mat-icon>
        <span class="rating-count">({{ p.reviews || 0 }} reviews)</span>
      </div>

      <div class="price-box">
        <span class="price">₹{{ p.price }}</span>
        <span class="mrp" *ngIf="p.mrp && p.mrp > p.price">₹{{ p.mrp }}</span>
        <span class="discount" *ngIf="p.mrp && p.mrp > p.price">{{ getDiscountPercent(p) }}% off</span>
      </div>

      <p class="stock" [class.low]="p.stock < 5">
        {{ p.stock === 0 ? 'Out of Stock' : p.stock + ' in stock' }}
      </p>

      <div class="description" *ngIf="p.description">
        <h3>Description</h3>
        <p>{{ p.description }}</p>
      </div>

      <div class="actions">
        <app-add-to-cart-button
          [product]="p"
          (quantityChange)="onQuantityChange(p, $event)">
        </app-add-to-cart-button>

        <button mat-stroked-button class="wishlist-btn"
                [class.active]="p.wishlisted"
                (click)="toggleWishlist()">
          <mat-icon>{{ p.wishlisted ? "favorite" : "favorite_border" }}</mat-icon>
          {{ p.wishlisted ? "Wishlisted" : "Add to Wishlist" }}
        </button>
      </div>

    </div>

  </div>
</div>

<ng-template #loading>
  <p class="loading-text">Loading product...</p>
</ng-template>
